{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Site-Man Agent Configuration",
  "type": "object",
  "required": [
    "id",
    "name",
    "description",
    "model",
    "routing",
    "persona",
    "memory",
    "knowledge"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]{2,40}$",
      "description": "Stable, URL-safe identifier used in registry and API paths."
    },
    "name": {
      "type": "string",
      "minLength": 2,
      "maxLength": 80
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 320
    },
    "model": {
      "type": "object",
      "required": ["provider", "mode", "defaultModel"],
      "properties": {
        "provider": {
          "type": "string",
          "description": "External LLM vendor (openai, anthropic, glama, local, etc.)."
        },
        "mode": {
          "type": "string",
          "enum": ["chat_completion", "completion", "inference_server"]
        },
        "defaultModel": { "type": "string" },
        "endpointEnv": {
          "type": "string",
          "description": "Environment variable exposing the HTTPS endpoint."
        },
        "apiKeyEnv": {
          "type": "string",
          "description": "Environment variable containing the API token." 
        },
        "temperature": { "type": "number", "minimum": 0, "maximum": 2 },
        "maxTokens": { "type": "integer", "minimum": 1 },
        "frequencyPenalty": { "type": "number" },
        "presencePenalty": { "type": "number" }
      }
    },
    "routing": {
      "type": "object",
      "required": ["defaultChannel"],
      "properties": {
        "defaultChannel": {
          "type": "string",
          "enum": ["sequential", "concurrent", "broadcast"]
        },
        "priority": { "type": "integer", "minimum": 0 },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "persona": {
      "type": "object",
      "required": ["systemPrompt"],
      "properties": {
        "systemPrompt": { "type": "string" },
        "style": { "type": "string" }
      }
    },
    "memory": {
      "type": "object",
      "required": ["shortTerm", "longTermMeta"],
      "properties": {
        "shortTerm": { "type": "string" },
        "longTermMeta": { "type": "string" }
      }
    },
    "knowledge": {
      "type": "object",
      "properties": {
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "path"],
            "properties": {
              "type": { "type": "string" },
              "path": { "type": "string" },
              "refreshCmd": { "type": "string" }
            }
          }
        }
      }
    },
    "tools": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "kind"],
        "properties": {
          "name": { "type": "string" },
          "kind": { "type": "string" },
          "entry": { "type": "string" },
          "description": { "type": "string" }
        }
      }
    },
    "telemetry": {
      "type": "object",
      "properties": {
        "logPath": { "type": "string" },
        "metrics": { "type": "string" }
      }
    }
  }
}
